---
title: Loterry scheduling
description: operating systems three easy pieces筆記
date: 2025-02-20
---

# Introduce
- different type of scheduler known as a proportional-share scheduler, also called as a **fair-share** scheduler
- 定期抽籤讓Loterry scheduler決定哪一個process應該執行
- 讓更常執行的process贏得更多的Loterry

# How to Share the CPU proportional

## Basic Concept: Tickets Represent Your Share
- tickets 代表了哪一個process獲得的source額度,假設A有75張的彩票,B有25張,
  - 我們會希望A佔用了75%的cpu resource,B則是25%的cpu resource

## Ticket Mechanisms
1. ticket currency
    - 假設有A和B都有各100張彩票,A分配給A1,A2各Acurrency張彩票
    - B只有一個工作給B1(100*(n/m))張彩票
    - 接著再從講池裡面抽A1,A2 or B
``` mermaid
graph TD;
A --> Acurrency;
Acurrency --> A1
Acurrency --> A2
A1 --> 60
A2 --> 40
60 --> A's\nglobal
40 --> A's\nglobal
B --> Bcurrency;
Bcurrency --> B1;
B1 --> global-A's\nglobal
```
2. ticket transfer
    - 在client,server端特別有用,client請求後可以transfer self ticket to server, let serbver speeder itself
3. ticket inflation
    - 假設process知道自己需要更多CPU,可以inflation self ticket來告素OS,這過程不需要告訴其他process

# 實現Lottery scheduling
```c
int counter = 0;
int wineer = getrandom(0,totaltickets);

node_t *current = head;
while(current) {
    counter = counter + current->tickets;
    if(counter > winner_tickets)
        break;
    current = current->next;
}
```
